\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\graphicspath{ {images/} }
\usepackage{amsmath}
\usepackage{gensymb}
\usepackage[english]{babel}
\usepackage[version=4]{mhchem}
\usepackage[T1]{fontenc}
\usepackage{wrapfig}
\usepackage[colorlinks,allcolors = blue]{hyperref} 
%\numberwithin{equation}{section}
%\numberwithin{figure}{section}
%\numberwithin{table}{section}

%\usepackage[font=scriptsize,labelfont=bf]{caption}
%\usepackage{subcaption}
\usepackage[backend=biber,style=authoryear-comp]{biblatex}
\usepackage[a4paper, portrait, margin=1in]{geometry}
\addbibresource{mybib_stable.bib}
\usepackage{listings}
\usepackage{xcolor}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}

\setlength{\parindent}{4em}
\setlength{\parskip}{1em}
\renewcommand{\baselinestretch}{1.5}

% \title{GIS For Dummies: Live Demonstration Guide}
% \author{Nicholas D. Barber}
% \date{\today}

\begin{document}

\begin{titlepage}
   \begin{center}
       \vspace*{1cm}

       \LARGE
       \textbf{GIS For Dummies: Session 2 Live Demo Guide}
       
       \Large
       \vspace{0.3cm}
        GIS Workshop prepared for McGill University Society for Economic Geology Student Chapter
            
       \vspace{1.2cm}
       \textbf{Nicholas D. Barber}\\
       Department of Earth Science\\
       University of Cambridge\\
       United Kingdom\\
       June 22nd, 2020
            
       \vspace{0.8cm}
     
       \includegraphics[width=0.9\textwidth]{Figure1_HazardMap_GP.png}
   \end{center}
\end{titlepage}

\tableofcontents

\section{Course Overview}

This guide was written in June of 2020 as an accompaniment to the "GIS for Dummies" workshop, organized by Catherine Crotty and Saraha Bodeving of McGill University (Canada). The workshop was presented in four parts, with the aim of introducing the use of Geographic Information Systems (GIS) to geoscientists in McGill's Society for Economic Geology (SEG) chapter. This section will provide a more general overview of the workshop, and preview the structure of the following guide, which is meant to accompany Part 2, Exercise 1. \textbf{All contents of this guide have been prepared by the course instructor, Nicholas Barber, and this guide can be shared under a MIT Shared Software License.} Feel free to share this guide and accompanying resources! \textit{Disclaimer: I (Nick Barber) claim no ownership of the data or underlying software used in this guide or this course.} 

This workshop was setup after preliminary discussions between myself, Catherine and Sarah throughout May 2020. In their role as organziers for their SEG chapter, they articulated a need to showcase what GIS is and what it can do for geoscientists. They wanted this course to include both a crash course for beginners, while also showcasing advanced features for more experienced users. Given the ongoing pandemic, the course was also to be hosted virtually. With these parameters in mind, I wrote an outline dividing our time into 4 blocks, to be spread over 4 days. Session 1 (Monday, June 15th) gave an overview lecture, covering the motivation for the course (Section XX), my background (see my web page), and the key theoretical material. The latter point as covered briefly, but ideally this topic will be given closer attention in a follow up GIS theory guide (this is a note to myself to write that, potentially for my undergrads). Wednesday June 17th saw Session 2, which in addition to this guide included a Lecture and a Live Demonstration of basic QGIS 3.10 functionality. The map on the title page is the desired output from Session 2. Session 3 will take place on Monday June 29th. The goal in this 2 hour block will be to run through some more advanced material, covering Python, spatial databases, mineral exploration (?) and style. Session 4 will be an open day where participants can schedule 1-1 thirty minute blocks with me, where I will advise them on their projects and the ways to get going with their particular analyses in GIS. 

The following sections will summarize Exercise 1, providing pictures with step by step details on how to replicate what I did in the live demo. I will start by briefly highlighting some of the goals and target skills in this demo. 

\subsection{Objectives}

The goal of this exercise to to familiarize users with the work flow of a typical GIS project.I wanted to show in (mostly) real time how you conceptualize a problem, find the data, set up the QGIS environment, conduct analyses, and export your desired output. I want this exercise to be both (1) an introduction to GIS project management and basic GIS analyses for users who may have never opened the program before, and (2) a refresher on basic GIS tasks, menus, and tools for more experienced users. \textbf{My hope is that whether you are a new or returning GIS user, you leave this workshop with a fuller appreciation of the functionality of GIS and the applications of GIS in geological research.} 

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.8\textwidth]{Google Map Overview of GP and Quito.png}
    \label{fig:fig1}
    \caption{Screen shot of Guagua Pichincha, looking North with Quito, capitol city of Ecuador, dominating the lowlands to the East. Image taken from Google Maps on June 23rd, 2020. }
\end{figure}

Our research question for this exercise: \textbf{How many people are at risk to the different eruptive products of Guagua Pichincha Volcano, Ecuador (Figure \ref{fig:fig1})?} I selected this question for a few reasons. The first reason is that, on the whole, this question is pretty easy to answer using GIS. This is because the datasets required are quite readily available, and require minimal manipulation to get in a use able form. However, the challenge of this project is the fact that it requires non-geological data which geologists are often loathe to find. It also takes place in an area of the world many people in the McGill SEG chapter may be unfamiliar with, and the metadata is even in another language! Further complicating things is that the geological information available is locked away in non-georeferenced datasets. So while this question is easy to address at a birds eye view, if you want to answer it \textbf{you need the a full appreciation of the core "GIS Toolkit," which is the goal of this course.}

\subsection{Transferable Skills}

Based on these goals, Exercise 1 should impart several important skills that will be useful in any GIS project:

\begin{itemize}
  \item Project Planning
  \item Locating Data and Understanding Metadata
  \item Importing Data
  \item Setting Up a QGIS Workspace
  \item Defining a Coordinate References System (CRS) and Projected Coordinate System (PCS) for your Project
  \item Reprojecting Data
  \item Georeferencing a Base Map
  \item Calculating Errors
  \item Geoprocessing
  \item Spatial Statistics
  \item Styling Raster and Vector Data
  \item Visualizing Geographic Data
\end{itemize}

\section{Project Panning + GIS Motivation}

The first topic addressed in the lecture was the need to properly articulate WHY you need GIS, and WHAT you intend to get out of a GIS analysis. This is similar to any self-directed critical question you'd ask yourself in research, e.g. "what am I hoping to achieve with this particular tool?" The reason I want to be up front about this need is because like any other research technique, GIS involves training, and you want to be sure the time invested in using GIS is invested wisely. Some of the operations I show you in this guide can be performed in other software suites - particularly using Python and R. If your goal is limited in scope, it might be worthwhile to see if any of your other skill-sets will allow you to answer the same question. 

With that preface in mind, there are several obvious reasons why you might plan a project with GIS in mind. When you want to take a range of spatial datasets, overlay them, analyze some feature(s), and produce a well defined, beautiful map, Python's command line (or cell-by-cell interface in case of an IDE like Jupyter Notebook) may not be the most logical and effective way to structure your project. One of the clear advantages of GIS software is its interface, which allows the user to control every aspect of the data in question, most especially its appearance. This interface is at the same time a big barrier for people getting into GIS - the first time you open QGIS, you'll be overwhelmed by the sheer number of menus, buttons, and tools at your disposal. This is where time investment, mentioned in the previous paragraph, really comes in. In my experience, half the battle in a GIS project is finding the right button or menu, which is often buried in some obscure interface. But the fact that there are so many ready-made tools and options in a software like QGIS adds to the value of the software. Rather than defining a spatial analysis procedure from scratch and formatting the resultant map using something like \textit{matplotlib}, GIS lets you does a lot of the background work for you. 

Another advantage of a GIS is its ability to contextualize your data. Say you are a geochemist, and you've spent months in the lab analyzing a suite of elements in your samples. After all that hard work, you will naturally want to extract the maximum scientific value out of your results. This can of course be done without a GIS, but as we shall see, overlaying your spatially-defined sample data with GIS layers describing the natural hazards, topography, hydrology, and demography in your study area can provide a much richer picture of the impact your results on the systems + people it comes from. If you had analysed whole rock chemistry of scoria from different eruptive periods at Guagua Pichincha, or modeled the record of earthquakes below the edifice over a long time period, you will be able to say with certainty what impact the hazard you've identified will have on the populations affected. This analogy extends beyond volcanology of course; you should be able to see the same spatial dimension in any geological dataset, and as soon as that dimension is visualized the apparent usefulness of GIS should jump out. Finally, I can't end this discus ion without highlighting the power of GIS to advance your career. In the private and public sector, having a GIS skill set marks you out as a great candidate for a host of jobs both in the field and in the office. Given the time and experience it takes to master GIS workflows, companies and organizations will value you for this skill, which is applicable well outside geology. In fact, GIS is arguably more important than many highly technical geological skills we learn in a PhD, as they are applicable in some many non-academic applications: think Google maps, software development, COVID tracking, environmental remediation, hydrogeology, subsurface exploration, etc. 

Having laid out all these considerations as to WHY you might choose to sue a GIS, the next logical step is to ask: "Where do I start?" The first point for any scientific investigation is your research question. Thanks to the discussion in the previous section, we already have that established in our case. It's worth adding that this question comes to us because Guagua Pichincha is only 10 km. W of Quito, the capitol of Ecuador. Depending on the nature of the hazards posed, we can hypothesize a large proportion of the population are under threat from this volcano. Our next step after framing our question is to think about what stage of our analysis GIS will factor into. GIS is incredibly helpful when planning field work, as the mapping functions should make obvious. However, GIS can also add that "context" to your data I mentioned before. Even if you don't need to do any exploration or data, the map-making functionality alone makes GIS essential for manuscript figure generation. Based on these features, we can break the "stages" of GIS applicability into a \textbf{Early Stage} (planning, querying available data, generating a research question), \textbf{Analysis Stage} (spatial statistics, validating analyses, contextualizing results, modeling), and a \textbf{Post-Analysis Stage} (figure creation, map making, preparing data for publication).  

Once we have the WHY and the WHERE, we need the WHAT and HOW: what specific steps and information do you need to set off on this project. This guide will examine the search for data and the specific steps for GIS analysis in great detail. However, two more factors can be brought into our project plan. The first is follows on from my lecture in Session 1, and that's the coordinate/projection system we are going to use. This will also be treated in some detail below, but regardless of which stage of GIS analysis you are in, this needs to be one of the first things thought about and decided upon. For now, we will put a pin in that as we search for the data we need and get our GIS work space set up for the first time. The second factor is something that comes with experience, and that's an early "sketch," of the steps we will need to take in our project. For example, I know looking at our research question, I'll essentially need to compare the areas of two vector files: the vector file describing the spatial footprint of the hazard, and the vector file describing the spatial distribution of the population. This operation is called an \textbf{Overlay} and can be accomplished with several different \textbf{Geoprocessing} tools, all with applicability in different situations. Like anything else, this forecasting of the tools needed to answer our questions only comes with practice. I'll share some more thoughts on this topic at the end of this document. However, for now, we are ready to begin our GIS journey. 

\section{Downloading and Installing Software}

Our choice of software for this workshop is QGIS, formerly known as Quantum GIS. QGIS is one of the most popular open-source GIS platforms, developed by a large team of professional + volunteer software developers since 2002 through the Open Source Geospatial Foundation (OSGEO: \href{https://www.osgeo.org}{https://www.osgeo.org}. QGIS is packaged into disk installers that work on all operating systems. At the time of writing this, I am using QGIS 3.10.6-A Coru\~na - this is the current Long Term Release (LTR), which will be supplanted by QGIS 3.14-Pi sometime in the next 6 months (see Figure \ref{fig:fig2}). If you are on a Mac (like me) the download disk should show multiple installers after opening. These should be installed in the following order: (1) Python-3.8, (2) GDAL-3.1, and then (3) QGIS-3.10.6. Python and GDAL must be installed prior to QGIS - QGIS has dependencies that link to both of these programs. If you are uncomfortable updating Python at this stage (this will likely only affect avid programmers), I recommend following the isntrucitons from this \href{https://github.com/rafdouglas/qgis_desktop_docker}{older docker build of QGIS 3.4/3.6}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{Figure2_Downloads.png}
    \label{fig:fig2}
    \caption{Screen shot of QGIS download page for Mac. As mentioned in text, this guide is based on the LTR 3.10.6-A Coru\~na. See QGIS docs for more details on versions and installation process.}
\end{figure}

There have been some dependency problems with GDAL 3.1 and QGIS, both in my experience and as reported on the forums. These are likely to be cleared up soon after this guide is published. However, in the event they aren't, it might be wise to install \textit{conda} or \textit{pip} versions of GDAL in their own environments. Using the Terminal on Mac, type one of the following:

% Can actually import code here:  \lstinputlisting[language=Octave]{BitXorMatrix.m}
\begin{lstlisting}[language=Python]
    conda install -c conda-forge gdal 
    #OR
    pip install GDAL
\end{lstlisting}

One of the recommended installation steps is to fix the paths to GDAL and Python on your system. QGIS sometimes has trouble finding these directories, and by fixing these paths you make it easier for the program to find the right modules. Figure \ref{fig:fig3} shows a screenshot of the pathing needed; to get to this menu, click the dropdown menu title 'QGIS', and select Preferences > System. Under System there is a collapsible menu called "Environment. Here you can enter your paths. You want to select 'Prepend' for APPLY, and 'PATH' for Variable. Enter the paths as described here if you use Mac. The installer will likely have different pathing instructions for Windows and Linux systems, but the essence of these instructions are the same. 

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{Figure3_Environment_Paths.png}
    \label{fig:fig3}
    \caption{Environment Menu under QGIS > Preferences > System dropdowns. If you are a Mac user, copy these three Prepend paths to map your QGIS properly. Othrwise, you might experience Python errors at start up.}
\end{figure}

\subsection{Plugins}

For this exercise, you will need the following plugins. These can be found in the main menu drop down (see Figure \ref{fig4}) under Plugins > Manage and Install Plugins. Notice how some plugins are marked as a "Core Plugin," with a cyan banner upon selecting. Long ago, these were standalone plugins, but have since been folded in as core features of QGIS. We will be using many of these core plugins as well:

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{FIgure4_Plugin_Menu.png}
    \label{fig4}
    \caption{My 'Manage Plugins' Menu. Notice how many more are enabled than you will need for this exercise; many of the plugins are useful but not to our current goals. Contact me if you have any questions about what some of these plugins do.}
\end{figure}

\begin{itemize}
    \item \textbf{Quick Map Services}: Should be a core plugin now, but will allow you to upload base maps. Base maps don't have geographical information per se, but they work as a good "base layer" for any map.
    \item \textbf{Globe Builder}: Useful plugin for larger scale maps, let's you create pseudo-3D spherical map projection centered on your data. Great for data visualization.
    \item \textbf{Easy Custom Labeling}: One of the most useful plugins for map making. Allows for detailed and intuitive user control of labels. Labelling is a famously painful procedure in GIS software, and this is one of the best tools I've found to make my labels consistent and appealing.
    \item \textbf{Memory Layer Saver}: If you are going to sue Easy Custom Labeling, I strongly recommend having this plugin enabled as well. Easy Custom Labeling outputs a unique data type, called a memory layer, that will disappear after a particular map session is over. Memory Layer Saver allows this layer to be saved and preserved for future sessions, guaranteeing map consistency as a project evolves.
    \item \textbf{GroupStats}: Simple but incredibly intuitive, this plugin lets you calculate statistical features of vector layer attributes, and export the results to a CSV. For a mroe detailed overview of its functionality, see: \href{https://anitagraser.com/2013/02/02/group-stats-tutorial/}{https://anitagraser.com/2013/02/02/group-stats-tutorial/}
    \item \textbf{QuickOSM}: A very sueful built in tool that helps users locate gernic, pen soruce datasets for mapping. Builds simple queries to access the publicly maintained data sets in the Open Street Map 
\end{itemize}

\section{Opening QGIS for the First Time}

Upon installation of QGIS and the recommended plugins, you are left with a bewildering array of menus, buttons, and windows. Like learning to read, the symbols and menus seem incomprehensibly arrayed, with no logic or order. It can be very overwhelming! Thankfully, this guide and future exercise will slowly introduce you to the important menus. My hope is that by the end of this exercise, you'll be able to locate some of the essential, day to day tools and functions with only a minor amount of googling. 

Through the previous few sections, you've already met a few menus. These have been accessed via the \textbf{Menu Bar}, a row of drop-down menus at the top of your screen. Below the Menu bar, is the array of \textbf{Toolbars} that can be enabled and disabled for view by selecting the Menu option "View", followed by "Toolbars," near the bottom of available options. These toolbars can be moved at will by clicking the vertical dotted lines separating each tool bar (see Figure 5). The center of the screen is taken up by the \textbf{Map View}. This is your work space, where all mappable elements will be displayed. To the left and right of the map view are \textbf{Panels}; these will be discussed in turn, but they are the menus that will allow you to visually control most of the features you care about with your map. Finally, the bottom of the screen has a greyed out area called the \textbf{Status Bar}, where details about the coordinates of view, scale, degree of rotation, projection system, and search bar are found. 

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{Fig_6_Toolbars.png}
    \label{fig6}
    \caption{Zoomed in screen shot of toolbars at the top of my QGIS interface. The vertical dotted lines used to move toolbars is highlighted with a red box.}
\end{figure}

For a more detailed visual tour, please see the QGIS documentation: \url{https://docs.qgis.org/3.10/en/docs/user_manual/introduction/qgis_gui.html}

\subsection{.qgz: The Project File}

Before moving on to the main part of this exercise, it's worth spending a moment to highlight the file structure that's going to be your home for all the fun analyses you are running: the Project file. This file type is essentially your container for every other file you are going to plot, analyze, combine, and map in the course of a GIS session. When you first open QGIS a blank project file is all you have the option to save. This file has the extension \textbf{.qgz}, and can be saved alongside your actual data files. Like other programs, you can take features of your project file, and save them as templates for future analyses if you like the way you structured a particular map. Two important aspects of a project file need to be made clear. First, a QGIS can only operate one project at a time; it's not possible at the moment to have multiple projects open like you would in Adobe Illustrator or Inkscape. Second, \textbf{saving a project file does not save your actual data, analysis, models, or maps.}. 

This second point is critical, and is often confused by new users. To illustrate this problem, I'll pose a simple and very realistic scenario illustrating what I mean. Imagine: after doing some work and making a pleasing looking map, you will naturally hit the "Save" button in the upper left icon menu, exit out, and continue with your work. Weeks later, you will reopen QGIS and immediately be met by a scary menu, telling you that QGIS can't find your files! This situation will often be met by smattering of curses, and may lead to you redoing a lot of your work. So what went wrong? What probably happened is that in the ensuing weeks since you started your .qgz file, you did some reorganizing in your hard drive and moved some of the shape files or raster files used for your map to another folder. Unlike many other applications, your project file and its contents are linked together very loosely. What this means in practice is that when you save a project file, you are essentially saving 1) styles and colors you've sued to make your map 2)the order of appearance of different layers 3) the projection system used 4) other metadata, but crucially not the actual files themselves. Those files exist in a unique portion of your hard drive with their own file path, so when you moved those files to a nice, orderly sub-folder AFTER the creation of your initial project file, QGIS essentially "lost track" of the data. 

All you need to do to fix this issue is to click on the files that are throwing an error, and find them in your hard drive (easier said than done when you come back to a project you haven't opened in six months!). The good thing about this setup is that even if you break, delete, or make a change you don't like to a project, the underlying data can still be saved. Given all this, I don't want you to leaver this section thinking that the lesson is here is not to avoid saving or caring about a project file. Rather, document for yourself where you've stored everything, and keep track of what changes are being made. The utility of a project file will become more apparent later on in this Exercise. For more information, see \url{https://docs.qgis.org/3.10/en/docs/user_manual/introduction/project_files.html}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{Figure 5.png}
    \label{fig5}
    \caption{Project file directory and options. This menu is from the "Properties," option, accessed from the "Project" drop-down in the main menu bar.}
\end{figure}

\section{Finding GIS Data}

After identifying your research question, installing QGIS and relevant plugins, and familiarizing yourself with the interface, you will probably be left staring at the screen, wondering: where do I go from here? This initial paralysis is understandable. Despite all the wonderful features of QGIS we are going to use to understand Guagua Pichincha, there's no road map readily available on where to go to find the data you need. Fortunately, many years of facing this same experience myself has led me to collate a host of resources that will make your first attempt at this easier. I provide URLs to each of these resources in turn in my 2nd Lecture, but I will provide a more detailed summary of each data source here. 

\begin{itemize}
    \item Mineral
\end{itemize}

\section{Importing Data}

\subsection{Vector}

\subsection{Raster}

\subsection{CSV}

\section{Defining Coordinate Systems and Projections}

\subsection{Reprojection}

\section{Setting Up Workspace}

\section{Georeferencing Our Base Map}

\section{Creating New Features}

\section{Accounting for errors}

\section{Analysis}

\subsection{Field Calculator}

\subsection{Geoprocessing}

\subsection{Statistics Viewer}

\section{Symbology}

\subsection{Vector}

\subsection{Digital Elevation Models (DEMs)}

\subsection{3D View}

\section{Creating a Map: Layout Manager}

\section{Final Thoughts}

\section{Data Sources and Further Reading}

\section{Acknowledgements}

\newpage
\printbibliography

\end{document}
